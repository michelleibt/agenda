<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agenda Interativa</title>
<style>
:root {
  --bg: #f3e8ff;
  --panel: #e9d5ff;
  --text: #4c1d95;
  --accent: #a78bfa;
  --ok: #6b21a8;
  --danger: #9333ea;
  --card: #ede9fe;
  --radius: 18px;
}
body { font-family:'Comic Sans MS', cursive, sans-serif; background: var(--bg); margin:0; color: var(--text); }
.wrap { max-width:480px; margin:24px auto; padding:0 12px; }
header { display:flex; flex-direction:column; align-items:center; gap:8px; margin-bottom:18px; }
h1 { margin:0; font-size:24px; text-align:center; }
.points { font-weight:bold; font-size:16px; color: var(--accent); }
.btn { border:none; padding:6px 10px; border-radius:12px; cursor:pointer; font-weight:bold; }
.btn.ok { background: var(--accent); color:#fff; }
.btn.danger { background: var(--danger); color:#fff; }
.btn.small { font-size:13px; }
.panel { background: var(--panel); border-radius: var(--radius); padding:16px; margin-bottom:20px; box-shadow:2px2px12px rgba(0,0,0,0.2); }
ul.tasks { list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:10px; }
.task { display:flex; flex-direction:column; background: var(--card); padding:10px; border-radius:12px; transition: all 0.3s ease; }
.task.done { opacity:0.6; text-decoration:line-through; transform: scale(1.02); }
.time { display:inline-block; background:#e0c7ff; padding:4px 8px; border-radius:6px; margin-right:8px; font-size:14px; }
.extra { font-weight:bold; color:#a78bfa; margin-left:6px; }
.progress-bar { display:flex; gap:4px; margin-top:6px; justify-content:center; }
.progress-bar div { width:32px; height:32px; border-radius:6px; background:#c4b5fd; transition: all 0.3s ease; display:flex; align-items:center; justify-content:center; color:#fff; font-weight:bold; font-size:18px; }
.progress-bar div.done { background:#6b21a8; transform: scale(1.1); box-shadow: 0 0 10px #a78bfa; animation: glow 1s ease-in-out infinite alternate; }
@keyframes glow { 0% { box-shadow:0 0 5px #a78bfa; } 100% { box-shadow:0 0 20px #d8b4fe; } }
table { width:100%; border-collapse: separate; border-spacing:0; border-radius:12px; overflow:hidden; margin-top:10px; font-size:14px; }
th, td { padding:8px; text-align:left; border:none; }
th { background:#c4b5fd; color: var(--text); font-weight:bold; }
tr:nth-child(even) td { background:#e9d5ff; }
tr:nth-child(odd) td { background:#ede9fe; }
.footer-note { text-align:center; margin-top:20px; font-weight:bold; color: var(--accent); }
#pointMsg { display:none; text-align:center; background: #a78bfa; color:#fff; padding:10px; border-radius:12px; font-weight:bold; margin-top:10px; }
.resgatados { margin-top:10px; font-size:14px; font-weight:bold; color: var(--ok);}
input[type="number"] { padding:6px; border-radius:8px; border:1px solid #ccc; width:100px; }
@media (max-width: 360px) {
    .wrap { padding: 0 6px; }
    .btn { padding:4px 8px; font-size:12px; }
}
</style>
</head>
<body>
<div class="wrap">
<header>
<h1>üóìÔ∏è Agenda Interativa</h1>
<div class="points">‚≠ê Pontos: <span id="points">0</span></div>
<div id="pointMsg">üéâ Parab√©ns! Voc√™ ganhou pontos da semana!</div>
</header>

<section class="panel">
<h2>Tarefas</h2>
<ul class="tasks" id="taskList"></ul>
<div id="emptyState" style="display:none">Nenhuma tarefa.</div>
</section>

<section class="panel">
<h2>Progresso da Semana</h2>
<div class="progress-bar" id="progressBar"></div>
</section>

<section class="panel">
<h2>Adicionar tarefa</h2>
<form id="taskForm" style="display:flex; flex-direction:column; gap:8px;">
<input id="title" type="text" placeholder="T√≠tulo" required />
<input id="time" type="time" />
<input id="weeklyPoints" type="number" placeholder="Pontos da tarefa" min="0" />
<button class="btn ok" type="submit">+ Adicionar</button>
</form>
</section>

<section class="panel">
<h2>üéÅ Tabela de Recompensas</h2>
<table id="rewardTable">
<tr><th>Pontos</th><th>Recompensa</th><th>A√ß√£o</th></tr>
<tr data-points="10"><td>10</td><td>Dinheiro salgado</td><td><button class="btn ok small resgatarBtn">Resgatar</button> <button class="btn danger small deleteRewardBtn">Excluir</button></td></tr>
<tr data-points="40"><td>40</td><td>R$10</td><td><button class="btn ok small resgatarBtn">Resgatar</button> <button class="btn danger small deleteRewardBtn">Excluir</button></td></tr>
<tr data-points="50"><td>50</td><td>Ox Burguer</td><td><button class="btn ok small resgatarBtn">Resgatar</button> <button class="btn danger small deleteRewardBtn">Excluir</button></td></tr>
</table>
<div class="resgatados">Itens resgatados: <span id="resgatadosList">Nenhum</span></div>
</section>

<div class="footer-note">Complete todas as tarefas da semana e ganhe um pr√™mio! üéâ</div>
</div>

<script>
const $ = (s)=>document.querySelector(s);
const $$ = (s)=>document.querySelectorAll(s);
const uid = ()=>Math.random().toString(36).slice(2,9);
const daysIcons = ['D','S','T','Q','Q','S','S'];

function defaultTasks(){
  return [
    { id: uid(), title:'üè´ Chegar na escola', time:'07:20', doneDays:[], weeklyPoints:0 },
    { id: uid(), title:'üè´ Sa√≠da da escola', time:'12:10', doneDays:[], weeklyPoints:0 },
    { id: uid(), title:'üè† Chegar em casa', time:'13:15', doneDays:[], weeklyPoints:0 },
    { id: uid(), title:'üçΩÔ∏è Almo√ßo', time:'13:19', doneDays:[], weeklyPoints:0 },
    { id: uid(), title:'üßº Lavar lou√ßa', time:'13:40', doneDays:[], weeklyPoints:0 },
    { id: uid(), title:'üç≤ Fazer jantar (Segunda e Ter√ßa)', time:'14:00', doneDays:[], weeklyPoints:0 }, // sem pontos
    { id: uid(), title:'üé¨ Postar v√≠deo no YouTube (Quinta)', doneDays:[], weeklyPoints:0 }
  ];
}

let state = JSON.parse(localStorage.getItem('agenda-toggle')) || { tasks: defaultTasks(), points:0, weekStart: new Date().getTime(), resgatados: [] };

function save(){ localStorage.setItem('agenda-toggle', JSON.stringify(state)); }

function showPointMessage(msgText){ 
    const msg = $('#pointMsg'); 
    msg.innerText = msgText;
    msg.style.display='block'; 
    setTimeout(()=>{ msg.style.display='none'; },2000); 
}

function checkWeekReset(){
    const now = new Date();
    const lastWeek = new Date(state.weekStart);
    const weekDiff = Math.floor((now - lastWeek)/(1000*60*60*24*7));
    if(weekDiff>=1){
        state.tasks.forEach(t=>t.doneDays=[]);
        state.points = 0; // Reset pontos semanais
        state.weekStart = now.getTime();
        save();
        showPointMessage('Nova semana! Pontos resetados.');
    }
}

function updateProgressBar(){
    const bar = $('#progressBar'); bar.innerHTML='';
    for(let i=0;i<7;i++){
        const dayBlock = document.createElement('div');
        dayBlock.innerText = daysIcons[i];
        if(state.tasks.every(t => t.doneDays.includes(i))){
            dayBlock.classList.add('done');
        }
        bar.append(dayBlock);
    }
}

function renderTasks(){
    checkWeekReset();
    const today = new Date().getDay();
    const list = $('#taskList'); list.innerHTML='';
    if(state.tasks.length===0){ $('#emptyState').style.display='block'; } else { $('#emptyState').style.display='none'; }

    state.tasks.forEach(t=>{
        const li=document.createElement('li'); li.className='task';
        const topDiv=document.createElement('div'); topDiv.style.display='flex'; topDiv.style.alignItems='center';
        const time=document.createElement('div'); time.className='time'; time.innerText=t.time||'--:--';
        const title=document.createElement('div'); title.innerText=t.title;
        if(t.weeklyPoints){ const star=document.createElement('span'); star.className='extra'; star.innerHTML='‚≠ê+'+t.weeklyPoints; title.appendChild(star); }
        if(t.doneDays.includes(today)){ li.classList.add('done'); }
        topDiv.append(time,title);

        const buttonsDiv=document.createElement('div'); buttonsDiv.style.marginTop='6px';
        const btnDone=document.createElement('button'); btnDone.className='btn ok small'; btnDone.innerText='Conclu√≠do';
        btnDone.onclick = () => {
            const idx = t.doneDays.indexOf(today);
            if(idx === -1){
                t.doneDays.push(today);
                if(t.weeklyPoints) {
                    state.points += t.weeklyPoints;
                    showPointMessage(`+${t.weeklyPoints} pontos!`);
                }
            } else {
                t.doneDays.splice(idx,1);
                if(t.weeklyPoints) state.points -= t.weeklyPoints;
            }
            save(); renderTasks(); updateProgressBar(); updatePoints();
        };
        const btnDel=document.createElement('button'); btnDel.className='btn danger small'; btnDel.innerText='Excluir';
        btnDel.onclick = () => { state.tasks = state.tasks.filter(x=>x.id!==t.id); save(); renderTasks(); updateProgressBar(); };
        buttonsDiv.append(btnDone, btnDel);
        li.append(topDiv, buttonsDiv);
        list.appendChild(li);
    });
}

function updateRewards(){
    const resList = $('#resgatadosList');
    if(state.resgatados.length===0) resList.innerText='Nenhum';
    else resList.innerText = state.resgatados.join(', ');
}

function updatePoints(){ $('#points').innerText = state.points; }

function setupRewards(){
    $$('.resgatarBtn').forEach(btn=>{
        btn.onclick = function(){
            const tr = btn.closest('tr');
            const points = parseInt(tr.dataset.points);
            const reward = tr.children[1].innerText;
            if(state.points>=points && !state.resgatados.includes(reward)){
                state.points -= points;
                state.resgatados.push(reward);
                btn.innerText='Resgatado'; btn.disabled=true;
                save(); updatePoints(); updateRewards();
                showPointMessage(`Recompensa "${reward}" resgatada!`);
            } else {
                showPointMessage('N√£o tem pontos suficientes ou j√° resgatou!');
            }
        }
    });

    $$('.deleteRewardBtn').forEach(btn=>{
        btn.onclick = function(){
            const tr = btn.closest('tr');
            tr.remove();
            showPointMessage('Recompensa exclu√≠da!');
        }
    });
}

// Inicializa√ß√£o
document.getElementById('taskForm').addEventListener('submit', (e)=>{
    e.preventDefault();
    const title = $('#title').value.trim();
    const time = $('#time').value;
    const points = parseInt($('#weeklyPoints').value) || 0;
    if(title){
        state.tasks.push({ id:uid(), title, time, doneDays:[], weeklyPoints:points });
        $('#title').value=''; $('#time').value=''; $('#weeklyPoints').value='';
        save(); renderTasks(); updateProgressBar();
    }
});

renderTasks(); updateProgressBar(); setupRewards(); updatePoints(); updateRewards();
</script>
</body>
</html>

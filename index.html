<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agenda Interativa</title>
<style>
:root {
  --bg: #f3e8ff;
  --panel: #e9d5ff;
  --text: #4c1d95;
  --accent: #a78bfa;
  --ok: #6b21a8;
  --danger: #9333ea;
  --card: #ede9fe;
  --radius: 18px;
  --hover-shadow: rgba(0,0,0,0.2);
}
* { box-sizing: border-box; }
body { font-family:'Comic Sans MS', cursive, sans-serif; background: var(--bg); margin:0; color: var(--text); }
.wrap { max-width:480px; margin:24px auto; padding:0 12px; }
header { display:flex; flex-direction:column; align-items:center; gap:8px; margin-bottom:18px; }
h1 { margin:0; font-size:24px; text-align:center; }
.points { font-weight:bold; font-size:16px; color: var(--accent); }

.btn { border:none; padding:6px 10px; border-radius:12px; cursor:pointer; font-weight:bold; transition: all 0.2s ease; }
.btn:hover:not(:disabled) { transform: scale(1.05); }
.btn:disabled { opacity:0.6; cursor:not-allowed; }

.btn.ok { background: var(--accent); color:#fff; }
.btn.danger { background: var(--danger); color:#fff; }
.btn.small { font-size:13px; }

.panel { background: var(--panel); border-radius: var(--radius); padding:16px; margin-bottom:20px; box-shadow:2px2px12px var(--hover-shadow); }
ul.tasks { list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:10px; }
.task { display:flex; flex-direction:column; background: var(--card); padding:10px; border-radius:12px; transition: all 0.3s ease; }
.task.done { opacity:0.6; text-decoration:line-through; transform: scale(1.02); }
.time { display:inline-block; background:#e0c7ff; padding:4px 8px; border-radius:6px; margin-right:8px; font-size:14px; }
.extra { font-weight:bold; color:#a78bfa; margin-left:6px; }
.restricted { font-size:12px; color: var(--danger); font-weight:bold; margin-left:5px; }

.progress-bar { display:flex; gap:4px; margin-top:6px; justify-content:center; }
.progress-bar div { width:32px; height:32px; border-radius:6px; background:#c4b5fd; transition: all 0.3s ease; display:flex; align-items:center; justify-content:center; color:#fff; font-weight:bold; font-size:18px; }
.progress-bar div.done { background: var(--ok); transform: scale(1.1); box-shadow: 0 0 10px var(--accent); animation: glow 1s ease-in-out infinite alternate; }
@keyframes glow { 0% { box-shadow:0 0 5px var(--accent); } 100% { box-shadow:0 0 20px #d8b4fe; } }

table { width:100%; border-collapse: separate; border-spacing:0; border-radius:12px; overflow:hidden; margin-top:10px; font-size:14px; }
th, td { padding:8px; text-align:left; border:none; }
th { background:#c4b5fd; color: var(--text); font-weight:bold; }
tr:nth-child(even) td { background:#e9d5ff; }
tr:nth-child(odd) td { background:#ede9fe; }

.footer-note { text-align:center; margin-top:20px; font-weight:bold; color: var(--accent); }
#pointMsg { display:none; text-align:center; background: var(--accent); color:#fff; padding:10px; border-radius:12px; font-weight:bold; margin-top:10px; }
.resgatados { margin-top:10px; font-size:14px; font-weight:bold; color: var(--ok);}
</style>
</head>
<body>
<div class="wrap">
<header>
<h1>üóìÔ∏è Agenda Interativa</h1>
<div class="points">‚≠ê Pontos: <span id="points">0</span></div>
<div id="pointMsg">üéâ Parab√©ns! Voc√™ ganhou pontos da semana!</div>
</header>

<section class="panel">
<h2>Tarefas</h2>
<ul class="tasks" id="taskList"></ul>
<div id="emptyState" style="display:none">Nenhuma tarefa.</div>
</section>

<section class="panel">
<h2>Progresso da Semana</h2>
<div class="progress-bar" id="progressBar"></div>
</section>

<section class="panel">
<h2>Adicionar tarefa</h2>
<form id="taskForm" style="display:flex; flex-direction:column; gap:8px;">
<input id="title" type="text" placeholder="T√≠tulo" required />
<input id="time" type="time" />
<button class="btn ok" type="submit">+ Adicionar</button>
</form>
</section>

<section class="panel">
<h2>üéÅ Tabela de Recompensas</h2>
<table id="rewardTable">
<tr><th>Pontos</th><th>Recompensa</th><th>A√ß√£o</th></tr>
<tr data-points="10"><td>10</td><td>Dinheiro salgado</td><td><button class="btn ok small resgatarBtn">Resgatar</button> <button class="btn danger small">Excluir</button></td></tr>
<tr data-points="40"><td>40</td><td>R$10</td><td><button class="btn ok small resgatarBtn">Resgatar</button> <button class="btn danger small">Excluir</button></td></tr>
<tr data-points="50"><td>50</td><td>Ox Burguer</td><td><button class="btn ok small resgatarBtn">Resgatar</button> <button class="btn danger small">Excluir</button></td></tr>
</table>
<div class="resgatados">Itens resgatados: <span id="resgatadosList">Nenhum</span></div>
</section>

<div class="footer-note">Complete todas as tarefas da semana e ganhe um pr√™mio! üéâ</div>
</div>

<script>
const $ = (s)=>document.querySelector(s);
const $$ = (s)=>document.querySelectorAll(s);
const uid = ()=>Math.random().toString(36).slice(2,9);
const daysIcons = ['D','S','T','Q','Q','S','S'];

function defaultTasks(){
  return [
    { id: uid(), title:'üè´ Chegar na escola', time:'07:20', allowedDays:[0,1,2,3,4,5,6], weeklyPoints:0, doneDays:[] },
    { id: uid(), title:'üè´ Sa√≠da da escola', time:'12:10', allowedDays:[0,1,2,3,4,5,6], weeklyPoints:0, doneDays:[] },
    { id: uid(), title:'üè† Chegar em casa', time:'13:15', allowedDays:[0,1,2,3,4,5,6], weeklyPoints:0, doneDays:[] },
    { id: uid(), title:'üçΩÔ∏è Almo√ßo', time:'13:19', allowedDays:[0,1,2,3,4,5,6], weeklyPoints:0, doneDays:[] },
    { id: uid(), title:'üßº Lavar lou√ßa', time:'13:40', allowedDays:[0,1,2,3,4,5,6], weeklyPoints:0, doneDays:[] },
    { id: uid(), title:'üç≤ Fazer jantar', time:'14:00', allowedDays:[1,2], weeklyPoints:10, doneDays:[] },
    { id: uid(), title:'üé¨ Postar v√≠deo no YouTube', time:'11:00', allowedDays:[4], weeklyPoints:0, doneDays:[] }
  ];
}

// Carrega o estado, garante fallback
let state = JSON.parse(localStorage.getItem('agenda-toggle')) || { tasks: defaultTasks(), points:0, weekStart: new Date().getTime(), resgatados: [] };

function save(){ localStorage.setItem('agenda-toggle', JSON.stringify(state)); }
function showPointMessage(){ const msg = $('#pointMsg'); msg.style.display='block'; setTimeout(()=>{ msg.style.display='none'; },2000); }

function checkWeekReset(){
    const now = new Date();
    const lastWeek = new Date(state.weekStart);
    const weekDiff = Math.floor((now - lastWeek)/(1000*60*60*24*7));
    if(weekDiff>=1){
        state.tasks.forEach(t=>t.doneDays=[]);
        state.weekStart = now.getTime();
        save();
    }
}

function updateProgressBar(){
    const bar = $('#progressBar'); bar.innerHTML='';
    for(let i=0;i<7;i++){
        const dayBlock = document.createElement('div');
        dayBlock.innerText = daysIcons[i];
        if(state.tasks.every(t => t.allowedDays.includes(i) ? t.doneDays.includes(i) : true)){
            dayBlock.classList.add('done');
        }
        bar.append(dayBlock);
    }
}

function renderTasks(){
    checkWeekReset();
    const today = new Date().getDay();
    const list = $('#taskList'); list.innerHTML='';

    if(state.tasks.length===0) state.tasks = defaultTasks();

    state.tasks.forEach(t=>{
        if(!t.id) t.id = uid();
        const li=document.createElement('li'); li.className='task';
        const topDiv=document.createElement('div'); topDiv.style.display='flex'; topDiv.style.alignItems='center';
        const time=document.createElement('div'); time.className='time'; time.innerText=t.time||'--:--';
        const title=document.createElement('div'); title.innerText=t.title;

        if(t.weeklyPoints){ const star=document.createElement('span'); star.className='extra'; star.innerHTML='‚≠ê+'+t.weeklyPoints; title.appendChild(star); }
        if(t.allowedDays.length<7){
            const info = document.createElement('span'); info.className='restricted'; info.innerText='Dias: '+t.allowedDays.map(d=>daysIcons[d]).join(',');
            title.appendChild(info);
        }
        if(t.doneDays.includes(today)) li.classList.add('done');
        topDiv.append(time,title);

        const buttonsDiv=document.createElement('div'); buttonsDiv.style.marginTop='6px';
        const btnDone=document.createElement('button'); btnDone.className='btn ok small'; btnDone.innerText='Conclu√≠do';
        btnDone.onclick = ()=>{
            if(!t.allowedDays.includes(today)){
                alert('Essa tarefa n√£o pode ser conclu√≠da hoje!');
                return;
            }
            const idx = t.doneDays.indexOf(today);
            idx===-1 ? t.doneDays.push(today) : t.doneDays.splice(idx,1);
            save(); renderTasks(); updateProgressBar(); checkWeekPoints();
        };
        const btnDel=document.createElement('button'); btnDel.className='btn danger small'; btnDel.innerText='Excluir';
        btnDel.onclick = ()=>{ state.tasks = state.tasks.filter(x=>x.id!==t.id); save(); renderTasks(); updateProgressBar(); };
        buttonsDiv.append(btnDone, btnDel);

        li.append(topDiv,buttonsDiv);
        list.appendChild(li);
    });

    $('#emptyState').style.display = list.children.length === 0 ? 'block' : 'none';
}

function checkWeekPoints(){
    const allDone = state.tasks.every(t => t.allowedDays.every(d => t.doneDays.includes(d)));
    if(allDone){
        const totalPoints = state.tasks.reduce((acc,t)=>acc+t.weeklyPoints,0);
        if(totalPoints>0){
            state.points += totalPoints;
            save(); updatePoints(); showPointMessage();
        }
    }
}

function updateRewards(){
    $('#resgatadosList').innerText = state.resgatados.length ? state.resgatados.join(', ') : 'Nenhum';
}

function updatePoints(){ $('#points').innerText = state.points; }

function setupRewards(){
    $$('.resgatarBtn').forEach(btn=>{
        btn.onclick = function(){
            const tr = btn.closest('tr');
            const points = parseInt(tr.dataset.points);
            const reward = tr.children[1].innerText;
            if(state.points>=points && !state.resgatados.includes(reward)){
                state.points -= points;
                state.resgatados.push(reward);
                btn.innerText='Resgatado'; btn.disabled=true;
                save(); updatePoints(); updateRewards();
            } else {
                alert('N√£o tem pontos suficientes ou j√° resgatou!');
            }
        }
    });
}

$('#taskForm').addEventListener('submit',(e)=>{
    e.preventDefault();
    const title = $('#title').value.trim();
    const time = $('#time').value;
    if(title){
        state.tasks.push({ id:uid(), title, time, allowedDays:[0,1,2,3,4,5,6], weeklyPoints:0, doneDays:[] });
        $('#title').value=''; $('#time').value='';
        save(); renderTasks(); updateProgressBar();
    }
});

renderTasks(); updateProgressBar(); setupRewards(); updatePoints(); updateRewards();
</script>
</body>
</html>
